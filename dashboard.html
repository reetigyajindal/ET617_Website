<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Learning Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="dashboard-page">

  <h1>Welcome to your Learning Dashboard</h1>

  <nav>
    <button id="btn-text">Text Lesson</button>
    <button id="btn-video">Video Lesson</button>
    <button id="btn-quiz">Quiz</button>
  </nav>

  <section id="content-area">
    <p>Please select a content type above.</p>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBCu3bsWsLFAtTmNoXFyf-JhGZWTrYvwP8",
        authDomain: "et617-website.firebaseapp.com",
        projectId: "et617-website",
        storageBucket: "et617-website.firebasestorage.app",
        messagingSenderId: "749472859215",
        appId: "1:749472859215:web:26582c9707c7eea04e163a",
        measurementId: "G-3YPV9X0MMY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function getUserIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch {
        return '0.0.0.0';
      }
    }

    async function sendClickstream(eventContext, component, eventName, description) {
      const ip = await getUserIP();
      try {
        await addDoc(collection(db, "clickstream_events"), {
          time: serverTimestamp(),
          event_context: eventContext,
          component: component,
          event_name: eventName,
          description: description,
          origin: "web",
          ip_address: ip
        });
      } catch (error) {
        console.error("Error saving clickstream event:", error);
      }
    }

    window.showContent = function(type) {
      const contentArea = document.getElementById('content-area');

      if(type === 'text') {
        contentArea.innerHTML = `
          <h2>Text Lesson</h2>
          <p>3 + 7 = 10</p>
          <p>Box is in the shape of a cuboid</p>
        `;
        sendClickstream("Dashboard", "Navigation", "Clicked text button", "User viewed text content");
      }
      else if(type === 'video') {
        contentArea.innerHTML = `
          <h2>Video Lesson</h2>
          <video controls>
            <source src="assets/videos/sample-video.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          <p>Watch this video lesson carefully!</p>
        `;
        sendClickstream("Dashboard", "Navigation", "Clicked video button", "User viewed video content");
      }
      else if(type === 'quiz') {
        contentArea.innerHTML = `
          <h2>Quiz Time!!</h2>
          <form id="quiz-form">
            <div>
              <p>1. What is 5 + 9?</p>
              <label><input type="radio" name="q1" value="4"> 4</label><br>
              <label><input type="radio" name="q1" value="14"> 14</label><br>
              <label><input type="radio" name="q1" value="13"> 13</label><br>
            </div>
            <div>
              <p>2. What is the shape of a ball?</p>
              <label><input type="radio" name="q2" value="Cuboid"> Cuboid</label><br>
              <label><input type="radio" name="q2" value="Sphere"> Sphere</label><br>
              <label><input type="radio" name="q2" value="Circle"> Circle</label><br>
            </div>
            <button type="button" id="submit-quiz">Submit Quiz</button>
          </form>
          <p id="result"></p>
        `;
        sendClickstream("Dashboard", "Navigation", "Clicked quiz button", "User viewed quiz content");

        document.getElementById('submit-quiz').addEventListener('click', () => {
          checkAnswers();
          sendClickstream("Dashboard", "Quiz", "Quiz submitted", "User submitted the quiz");
        });
      }
    };

    window.checkAnswers = function() {
      let score = 0;
      const resultEl = document.getElementById('result');
      const q1 = document.querySelector('input[name="q1"]:checked');
      const q2 = document.querySelector('input[name="q2"]:checked');

      if (q1 && q1.value === '14') score++;
      if (q2 && q2.value === 'Sphere') score++;

      resultEl.textContent = `You scored ${score} out of 2.`;
    };

    document.getElementById('btn-text').addEventListener('click', () => window.showContent('text'));
    document.getElementById('btn-video').addEventListener('click', () => window.showContent('video'));
    document.getElementById('btn-quiz').addEventListener('click', () => window.showContent('quiz'));
  </script>

</body>
</html>
